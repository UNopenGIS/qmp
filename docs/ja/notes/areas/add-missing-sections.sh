#!/bin/bash

# å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# å“è³ªãƒã‚§ãƒƒã‚¯ã§å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒä¸è¶³ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸€æ‹¬ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

echo "ğŸ”§ å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œé–‹å§‹"
echo "======================================="

# å‡¦ç†å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆï¼ˆNotes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒä¸è¶³ã—ã¦ã„ã‚‹ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
FILES=(
    "am.md" "ar.md" "at.md" "az.md" "bf.md" "bg.md" 
    "bj.md" "bn.md" "bo.md" "bw.md" "ca.md" "ci.md" 
    "cl.md" "cm.md" "dz.md" "ee.md" "eg.md" "fj.md" 
    "ge.md" "gt.md" "hr.md" "iq.md" "ir.md" "is.md" 
    "jm.md" "kg.md" "kh.md" "kz.md" "la.md" "lb.md" 
    "lv.md" "ma.md" "mg.md" "mm.md" "mt.md" "my.md" 
    "nz.md" "ph.md" "pl.md" "pw.md" "qa.md" "ro.md" 
    "rs.md" "ru.md" "sa.md" "sg.md" "sn.md" "th.md" 
    "tj.md" "tm.md" "tr.md" "ug.md" "uy.md" "uz.md"
)

# å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
NOTES_SECTION="
## Notes

ã“ã®å›½ã§ã®OpenStreetMapæ´»å‹•ã¨QMPå–ã‚Šçµ„ã¿ã«é–¢ã™ã‚‹é‡è¦ãªæƒ…å ±ã‚’ã“ã“ã«è¨˜è¼‰ã—ã¾ã™ã€‚

### OSMã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çŠ¶æ³

- ãƒãƒƒãƒ‘ãƒ¼æ•°: èª¿æŸ»ä¸­
- æ´»å‹•ãƒ¬ãƒ™ãƒ«: èª¿æŸ»ä¸­  
- ä¸»è¦éƒ½å¸‚ã®ã‚«ãƒãƒ¬ãƒƒã‚¸: èª¿æŸ»ä¸­
- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ: èª¿æŸ»ä¸­

### JICAãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®é–¢é€£

- æŠ€è¡“å”åŠ›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: èª¿æŸ»ä¸­
- é–‹ç™ºå”åŠ›: èª¿æŸ»ä¸­
- äººæè‚²æˆ: èª¿æŸ»ä¸­
- ã‚¤ãƒ³ãƒ•ãƒ©æ•´å‚™: èª¿æŸ»ä¸­

### QMPã§ã®å–ã‚Šçµ„ã¿æ–¹é‡

- ãƒ‡ãƒ¼ã‚¿å“è³ªå‘ä¸Š: æ®µéšçš„æ”¹å–„
- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è‚²æˆ: ç¾åœ°ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã®å”åŠ›
- æŠ€è¡“ç§»è»¢: é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã®é¸å®š
- æŒç¶šå¯èƒ½æ€§: é•·æœŸçš„è¦–ç‚¹ã§ã®è¨ˆç”»

### è¨€èªå¯¾å¿œ

- ä¸»è¦è¨€èª: èª¿æŸ»ä¸­
- OSMã§ã®è¨€èªã‚¿ã‚°: name:xx å½¢å¼ã§å¯¾å¿œ
- å¤šè¨€èªã‚µãƒãƒ¼ãƒˆ: å¿…è¦ã«å¿œã˜ã¦å®Ÿè£…

### é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

- æ”¿åºœå…¬å¼ã‚µã‚¤ãƒˆ: èª¿æŸ»ä¸­
- OSMé–¢é€£æƒ…å ±: éšæ™‚æ›´æ–°
- åœ°ç†ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: åˆ©ç”¨å¯èƒ½æ€§ã‚’ç¢ºèªä¸­"

processed_count=0
skipped_count=0

for file in "${FILES[@]}"; do
    if [[ -f "$file" ]]; then
        echo "ğŸ“„ å‡¦ç†ä¸­: $file"
        
        # ## Notes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if grep -q "^## Notes" "$file"; then
            echo "  âš ï¸  æ—¢ã« Notes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ - ã‚¹ã‚­ãƒƒãƒ—"
            ((skipped_count++))
            continue
        fi
        
        # Information Source ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã« Notes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ¿å…¥
        if grep -q "^## Information Source" "$file"; then
            # awk ã‚’ä½¿ã£ã¦é©åˆ‡ãªä½ç½®ã«æŒ¿å…¥
            awk -v notes="$NOTES_SECTION" '
            /^## Information Source/ { 
                in_info_source = 1 
                print
                next
            }
            /^##/ && !/^## Information Source/ && in_info_source { 
                print notes
                in_info_source = 0 
                print
                next
            }
            { print }
            ' "$file" > "${file}.tmp" && mv "${file}.tmp" "$file"
            
            echo "  âœ… Notes ãŠã‚ˆã³å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã—ãŸ"
            ((processed_count++))
        else
            echo "  âš ï¸  Information Source ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ - ã‚¹ã‚­ãƒƒãƒ—"
            ((skipped_count++))
        fi
    else
        echo "  âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $file"
        ((skipped_count++))
    fi
done

echo ""
echo "ğŸ“Š å‡¦ç†çµæœã‚µãƒãƒªãƒ¼:"
echo "=================="
echo "âœ… å‡¦ç†æˆåŠŸ: $processed_count ãƒ•ã‚¡ã‚¤ãƒ«"
echo "âš ï¸  ã‚¹ã‚­ãƒƒãƒ—: $skipped_count ãƒ•ã‚¡ã‚¤ãƒ«"
echo "ğŸ“ ç·å¯¾è±¡: $((processed_count + skipped_count)) ãƒ•ã‚¡ã‚¤ãƒ«"

echo ""
echo "ğŸš€ courage to map - ç§ãŸã¡ã¯ç”ŸæˆAIã¨å…±å‰µã™ã‚‹"
